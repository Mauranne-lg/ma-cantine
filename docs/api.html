<!-- api.html -->
<!-- Documentation of the API displayed in the swagger -->


<h2>G√©n√©ral</h2>

Cette API permet de s'interfacer √† l'application ma-cantine afin de r√©aliser les d√©marches d'administration des cantines

Vous pouvez tester l'API depuis cette page. Nous fournissons √©galement un <a href="https://github.com/betagouv/ma-cantine-demo-integration">exemple d'application</a> en python.

<b>Important :</b> Les tests se font obligatoirement sur la plateforme de <a href="https://ma-cantine-demo.cleverapps.io/" target="_blank">d√©mo</a> (la suite de la doc r√©f√©rencera toujours l'instance de d√©mo). La plateforme de <a href="https://ma-cantine.agriculture.gouv.fr" target="_blank">prod</a> est r√©serv√©e aux donn√©es r√©elles.
<h2>Autorisation</h2>
L'API est prot√©g√© par le protocole d'autorisation OAuth2 (avec le package <a href="https://django-oauth-toolkit.readthedocs.io/en/latest/">Django OAuth Toolkit Documentation</a>). Afin d'obtenir une autorisation, il faut :
<ul>
<li>Avoir un compte de d√©v sur la plateforme <i>ma cantine</i>. Quand vous <a href="https://ma-cantine-demo.cleverapps.io/creer-mon-compte" target="_blank">cr√©ez votre compte</a>, cocher le cas "Je suis une d√©veloppeuse ou un d√©veloppeur logiciel et j'ai besoin d'acc√©der aux APIs". Si vous avez d√©j√† un compte et vous voyez pas la page de documentation API, il vous faudra cocher ce cas sur la page <a href="https://ma-cantine-demo.cleverapps.io/mon-compte/profil" target="_blank">Mon compte</a></li>
<li>Avoir <a href="https://ma-cantine-demo.cleverapps.io/o/applications/" target="_blank">enregistr√© votre application</a> sur la plateforme ma-cantine. A ce stade, il vous faut sauvegarder le CLIENT_SECRET qui ne sera plus visible ensuite (seulement la version hash√©e le sera).</li>
<li>R√©cup√©rer le code d'autorisation (1er appel API). Ce code √† une dur√©e de vie d'une minute.</li>
<li>Utiliser ce code d'autorisation pour n√©gocier et r√©cuperer un token d'autorisation (2√®me appel API)</li>
</ul>

Vous serez ensuite autoris√© √† utiliser l'API avec vos m√™mes droits utilisateurs que sur la plateforme.

Vous pouvez utiliser ce swagger pour tester l'API. Obtenez l'autorisation n√©cessaire en cliquant sur le bouton vert <b>Authorize üîì</b>. Suivez le procotole d'autorisation en commencant par la partie la plus basse de la pop-up (<b>oauth2 (OAuth2, authorizationCode)"</b>).
Pour pouvoir tester sur le swagger, il faudra renseigner comme URI de redirection (callback), l'URI du swagger en terminant par `/swagger-ui/oauth2-redirect.html`

Cette √©tape va vous renvoyer vers une page 404 de l'application ma-cantine. C'est bon signe ! Vous pouvez alors r√©cup√©rer le code dans l'URL.
</br>
Exemple : <i>https://ma-cantine-demo.cleverapps.io/swagger-ui/oauth2-redirect.html/?code=<b>HRnXZzhez5WJVNzW7TgsLAbeFZOmB3</b>&state=RnJpIEp1bCAyNiAyMDI0IDExOjExOjE5IEdNVCswMjAwIChDZW50cmFsIEV1cm9wZWFuIFN1bW1lciBUaW1lKQ%3D%3D</i>


<h2>Gestion des erreurs</h2>
<i>En cours de r√©daction</i>
